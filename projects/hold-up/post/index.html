<!DOCTYPE html> <html> <head> <meta charset="utf-8"> <meta name="apple-mobile-web-app-capable" content="yes"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <meta name="viewport" content="width=device-width, initial-scale=1"> <title> Stop! Don&#39;t send your PHI | Alex Morley, PhD </title> <meta name="description" content=" Alex Morley "> <meta name="keywords" content="medicine, ethics, neuroscience, tech, programming, open science, open source, oss, foss"> <meta name="HandheldFriendly" content="True"> <meta name="MobileOptimized" content="320"> <!-- Social: Facebook / Open Graph --> <meta property="og:type" content="website"> <meta property="og:url" content="https://alexmorley.me/projects/hold-up/post/"> <meta property="og:title" content=" Stop! Don&#39;t send your PHI | Alex Morley, PhD "> <meta property="og:image" content="https://alexmorley.me"> <meta property="og:description" content=" Alex Morley "> <meta property="og:site_name" content="Alex Morley"> <meta property="og:locale" content="en_UK"> <!-- Social: Twitter --> <meta name="twitter:card" content="summary_large_image"> <meta name="twitter:site" content="@alex__morley"> <meta name="twitter:title" content=" Stop! Don&#39;t send your PHI | Alex Morley, PhD "> <meta name="twitter:description" content=" Alex Morley "> <meta name="twitter:image:src" content="https://alexmorley.me"> <!-- Social: Google+ / Schema.org --> <meta itemprop="name" content=" Stop! Don&#39;t send your PHI | Alex Morley, PhD "> <meta itemprop="description" content=" Alex Morley "> <meta itemprop="image" content="https://alexmorley.me"> <!-- rel prev and next --> <link rel="stylesheet" href="/assets/css/main.css"> <link rel="stylesheet" href="/assets/css/font-awesome.min.css"> <!-- Canonical link tag --> <link rel="canonical" href="https://alexmorley.me/projects/hold-up/post/"> <link rel="alternate" type="application/rss+xml" title="Alex Morley, PhD" href="https://alexmorley.me/feed.xml"> <script type="text/javascript"> var disqus_shortname = 'alexmorley'; var _gaq = _gaq || []; _gaq.push(['_setAccount', 'UA-XXXXX-XX']); _gaq.push(['_trackPageview']); (function() { var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true; ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js'; var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s); })(); </script> <script type="text/x-mathjax-config"> MathJax.Hub.Config({ TeX: { equationNumbers: { autoNumber: "all" } } }); </script> <script type="text/x-mathjax-config"> MathJax.Hub.Config({ tex2jax: { inlineMath: [ ['$','$'], ["\\(","\\)"] ], processEscapes: true } }); </script> <script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML" type="text/javascript"></script> </head> <body> <main class="wrapper"> <header class="site-header"> <nav class="nav"> <div class="container"> <h1 class="logo"><a href="/">Alex Morley, PhD<span></span></a></h1> <ul class="navbar"> <li><a href="/about">About</a></li> <li><a href="/cv">CV</a></li> <li><a href="/projects">Projects</a></li> <li><a href="/projects/mini-projects/applications">Applications</a></li> <br> </ul> </div> </nav> </header> <p>Here’s a problem you might have never had. Users sending things through to your backend that you don’t really want to store. Or putting things you do want to store in the wrong place so you end up storing them the wrong way.</p> <p>In my current line of work that’s often people putting card numbers in the wrong field. In my past it’s been protected health information anywhere you don’t want it to be. One thing we know people do (a lot) these days is ask GPT-powered chat interfaces to be their doctor. What if we want to stop people doing that? Or route them to a privacy-focussed version of the tool?</p> <p>For that specific use case we could do this within the LLM, or perhaps in a gateway layer. But the strongest privacy protection we can give is if the data is never sent to any backend at all. There’s no danger of it being logged, or stored for longer than it should be etc. (these things can be important from a liability perspective).</p> <p>Language models <em>are</em> the best way to detect intent from free-form text though.</p> <p>So, in the year of 2025 is it feasible to do this locally? We’ll need to:</p> <ul> <li>Find a language model: small enough to download at runtime (or embed in an app)</li> <li>Try find one that does what we want or, more find a base model and: <ul> <li>fine-tune it well enough to detect if the user is asking about their health</li> </ul> </li> <li>Find a way of running it in the browser (ideally with WebGPU so its fast enough)</li> </ul> <p>Let’s try!</p> <p><strong>Find a language model small enough to download at runtime (or embed in an app)</strong></p> <p>Instagram loads about 20Mb on my browser so that seemed like a reasonable target.</p> <p>Although my initial plan was to use a bert model from google which is &gt;500Mb. <a href="https://huggingface.co/google-bert/bert-base-uncased">google-bert/bert-base-uncased</a>. Even with a 4x shrinking from quantization it’s still likely to be over our budget. Let’s see if we can be happy with something &lt;200Mb and go from there.</p> <p><strong>Try find one that does what we want</strong></p> <p>This didn’t work. See my highly scientific testing below:</p> <p><img width="auto" height="256" alt="I have two cat = healthcare related?" src="https://github.com/user-attachments/assets/3f72e7a5-e4ed-4b24-a24b-f8e057ed61b2" /> <img width="auto" height="256" alt="Similar fail" src="https://github.com/user-attachments/assets/0c342112-3f34-488c-b31b-54c2cf09ed56" /> <img width="auto" height="256" alt="Similar fail" src="https://github.com/user-attachments/assets/b7255171-fa1b-42a5-b802-4e5d8589eb6c" /></p> <p><strong>Fine-tune it well enough to detect if the user is asking about their health</strong></p> <p>I was expecting this to be the hardest bit. And it was - although I spent much much much too long trying to fix various dependency and compilation issues before finding a docker image I could adapt for what I wanted to do. What I ended up doing was:</p> <ul> <li>Using Gemini a bunch of examples of healthcare and non-healthcare related questions</li> <li>Spun up a GPU Droplet on DO</li> <li>Built my docker image with all the dependencies for pytorch and huggingface’s optimum library</li> <li>Tweaked some sentence classification example scripts to do fine-tuning on my labelled dataset</li> <li>Tweaked another set of scripts for quantizing those models and exporting them into the Onnx format.</li> </ul> <p>I spent very little time on things that would make the model good - like parameter tuning, more-than-cursory evals or testing any data augmentation strategies (or generating enough data).</p> <p><strong>Find a way of running it in the browser</strong></p> <p>This part is relatively painless if you upload your model to huggingface in the right format. I could share you the repo to the code, but this part is just an index.html so view the source yourself!</p> <p>Although heavy lifting is done by transformers library from tensorflow.</p> <p><img width="574" height="403" alt="Image" src="https://github.com/user-attachments/assets/00fad1fd-260a-4af4-970c-349ab453d2d8" /> <img width="574" height="403" alt="Image" src="https://github.com/user-attachments/assets/eadbfb57-1185-4667-90f1-cc8c49c0a0b3" /> <img width="574" height="403" alt="Image" src="https://github.com/user-attachments/assets/1edbf24d-b8f6-4143-b5be-728beaaa8ee8" /></p> <p>It still sucks a bit. Especially with things that aren’t questions (that was a bias in the dataset I made). And its not robust to anything … e.g. single character insertions/deletion:</p> <p><code class="language-plaintext highlighter-rouge">what should I do if my leg is bleedin -&gt; healthcare (0.94)</code></p> <p><code class="language-plaintext highlighter-rouge">what should I do if my leg is bleeding -&gt; not healthcare (0.67)</code></p> <p>But it kind of works and I’m going to turn off my 3$/hour H100 GPU now!</p> <footer class="container"> <ul class="column" style="float:right"> <li><br></li> <li class="footer-icons" style="text-align:right"> <a href="//github.com/alexmorley" title="Fork me on GitHub!" style="text-decoration:none"><i class="fa fa-github"></i></a> <a href="//twitter.com/alex__morley" title="Follow me on Twitter!" style="text-decoration:none"><i class="fa fa-twitter"></i></a> <a href="//facebook.com/alexander.morley" title="Like "alexmorley.me" on Facebook!" style="text-decoration:none"><i class="fa fa-facebook"></i></a> <a href="//alexmorley.me/feed.xml" title=""alexmorley.me" RSS feed!" style="text-decoration:none"><i class="fa fa-rss"></i></a> </li> <li> <a href="/licence">alexmorley.me 2018</a> </li> </ul> <ul class="column" style="float:left"> <li class="footer_links"> <a href="https://github.com/alexmorley/alexmorley.github.io/tree/master/projects/hold-up/post/index.md">view</a> ∙ <a href="https://github.com/alexmorley/alexmorley.github.io/edit/master/projects/hold-up/post/index.md">edit</a> ∙ <a href="https://github.com/alexmorley/alexmorley.github.io/commits/master/projects/hold-up/post/index.md">history</a> </li> <li><a href="/licence">CC BY 4.0</a></li> <li><a href="/attributions">attributions</a></li> </ul> </footer> </main> </body> </html>
~                                                                                                                   
